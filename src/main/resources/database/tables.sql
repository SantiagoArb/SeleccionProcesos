-----------------------------------------TABLES-----------------------------------------

CREATE TABLE TBL_CANDIDATOS(
ID_CANDIDATO SERIAL NOT NULL,
NOMBRES VARCHAR(100) NOT NULL,
APELLIDOS VARCHAR(100) NOT NULL,
TIPO_DOCUMENTO VARCHAR(2) NOT NULL,
DOCUMENTO VARCHAR(30) NOT NULL,
EMAIL VARCHAR(200) NOT NULL
);

COMMENT ON TABLE TBL_CANDIDATOS IS 'Tabla para almacenar la informacion basica de los candidatos';
COMMENT ON COLUMN TBL_CANDIDATOS.ID_CANDIDATO IS 'Campo autoincrementable para identificar un candidato';

CREATE TABLE TBL_MAET_CAMPOS(
ID_MAET_CAMPO SERIAL NOT NULL,
CLAVE VARCHAR(20) NOT NULL,
DESCRIPCION VARCHAR(100) NOT NULL,
ID_ETAPA INTEGER NOT NULL
);

COMMENT ON TABLE TBL_MAET_CAMPOS IS 'Tabla de maestros donde se definen los campos de cada etapa';

CREATE TABLE TBL_PROCESOS(
ID_PROCESO SERIAL NOT NULL,
ID_CANDIDATO INTEGER NOT NULL,
FECHA_POSTULACION TIMESTAMP NOT NULL,
ETAPA_ACTUAL INTEGER
);

COMMENT ON TABLE TBL_PROCESOS IS 'Tabla donde se almacena la informacion general del proceso de un candidato';

CREATE TABLE TBL_RESULTADO_PROCESO(
ID_RESULTADO_PROCESO SERIAL NOT NULL,
ID_PROCESO INTEGER NOT NULL,
ID_MAET_CAMPO INTEGER NOT NULL,
RESPUESTA VARCHAR(200),
RESPUESTA_NUMERICA NUMERIC(8,0)
);

COMMENT ON TABLE TBL_RESULTADO_PROCESO IS 'Tabla donde se almacenan las respuestas de los items de cada etapa';

CREATE TABLE TBL_ETAPAS(
ID_ETAPA SERIAL NOT NULL,
NOMBRE VARCHAR(40) NOT NULL,
DESCRIPCION VARCHAR(100) NOT NULL
);

COMMENT ON TABLE TBL_ETAPAS IS 'Tabla donde se definen las etapas que va tener el proceso';

CREATE TABLE TBL_MAET_ROLES(
ID_ROL SERIAL NOT NULL,
NOMBRE VARCHAR(40) NOT NULL,
DESCRIPCION VARCHAR(100) NOT NULL
);

COMMENT ON TABLE TBL_MAET_ROLES IS 'Tabla donde se definen los roles';

CREATE TABLE TBL_FLUJO_ETAPAS(
ID_FLUJO_ETAPA SERIAL NOT NULL,
ETAPA_INICIAL INTEGER NOT NULL,
ETAPA_SIGUIENTE INTEGER NOT NULL
);

COMMENT ON TABLE TBL_FLUJO_ETAPAS IS 'Tabla donde se define el flujo y a donde puede ir cada etapa';

-----------------------------------------PRIMARY KEYS----------------------------------------
ALTER TABLE TBL_CANDIDATOS ADD CONSTRAINT TBL_CANDIDATOS_PK PRIMARY KEY (ID_CANDIDATO);
ALTER TABLE TBL_MAET_CAMPOS ADD CONSTRAINT TBL_MAET_CAMPOS_PK PRIMARY KEY (ID_MAET_CAMPO);
ALTER TABLE TBL_PROCESOS ADD CONSTRAINT TBL_PROCESOS_PK PRIMARY KEY (ID_PROCESO);
ALTER TABLE TBL_RESULTADO_PROCESO ADD CONSTRAINT TBL_RESULTADO_PROCESO_PK PRIMARY KEY (ID_RESULTADO_PROCESO);
ALTER TABLE TBL_ETAPAS ADD CONSTRAINT TBL_ETAPAS_PK PRIMARY KEY (ID_ETAPA);
ALTER TABLE TBL_MAET_ROLES ADD CONSTRAINT TBL_MAET_ROLES_PK PRIMARY KEY (ID_ROL);
ALTER TABLE TBL_FLUJO_ETAPAS ADD CONSTRAINT TBL_FLUJO_ETAPAS_PK PRIMARY KEY (ID_FLUJO_ETAPA);

-----------------------------------------FOREIGN KEYS----------------------------------------
ALTER TABLE TBL_PROCESOS ADD CONSTRAINT TBL_PROCESOS_TBL_CANDIDATOS_FK FOREIGN KEY (ID_CANDIDATO) REFERENCES TBL_CANDIDATOS(ID_CANDIDATO);
ALTER TABLE TBL_RESULTADO_PROCESO ADD CONSTRAINT TBL_RESULTADO_PROCESO_TBL_PROCESO_FK FOREIGN KEY(ID_PROCESO) REFERENCES TBL_PROCESOS(ID_PROCESO);
ALTER TABLE TBL_RESULTADO_PROCESO ADD CONSTRAINT TBL_RESULTADO_PROCESO_MAET_CAMPOS_FK FOREIGN KEY(ID_MAET_CAMPO) REFERENCES TBL_MAET_CAMPOS(ID_MAET_CAMPO);
ALTER TABLE TBL_MAET_CAMPOS ADD CONSTRAINT TBL_MAET_CAMPOS_TBL_ETAPAS_FK FOREIGN KEY(ID_ETAPA) REFERENCES TBL_ETAPAS(ID_ETAPA);
ALTER TABLE TBL_FLUJO_ETAPAS ADD CONSTRAINT TBL_FLUJO_ETAPAS_TBL_ETAPAS_FK FOREIGN KEY(ETAPA_INICIAL) REFERENCES TBL_ETAPAS(ID_ETAPA);
ALTER TABLE TBL_FLUJO_ETAPAS ADD CONSTRAINT TBL_FLUJO_ETAPAS_TBL_ETAPAS_FK2 FOREIGN KEY(ETAPA_SIGUIENTE) REFERENCES TBL_ETAPAS(ID_ETAPA);
ALTER TABLE TBL_PROCESOS ADD CONSTRAINT TBL_PROCESOS_TBL_ETAPAS_FK FOREIGN KEY(ETAPA_ACTUAL) REFERENCES TBL_ETAPAS(ID_ETAPA);

-----------------------------------------INSERTS INICIALES-------------------------------------

Insert into tbl_etapas values(1,'Etapa 1','primera etapa');
Insert into tbl_etapas values(2,'Etapa 2','segunda etapa');
Insert into tbl_etapas values(3,'Etapa 3','tercera etapa');

Insert into TBL_MAET_CAMPOS values(1,'etp1rol','Rol del aspirante', 1);
Insert into TBL_MAET_CAMPOS values(2,'etp1aspisalarial','Aspiracion Salarial', 1);
Insert into TBL_MAET_CAMPOS values(3,'etp1califteorica','Calificacion prueba teorica', 1);
Insert into TBL_MAET_CAMPOS values(4,'etp1califtecnica','Calificacion prueba tecnica', 1);
Insert into TBL_MAET_CAMPOS values(5,'etp1comentarios','Comentarios', 1);
Insert into TBL_MAET_CAMPOS values(6,'etp1evaluador','Nombre evaluador', 1);


Insert into TBL_MAET_CAMPOS values(7,'etp2califpsicologica','Entrevista psicologica', 2);
Insert into TBL_MAET_CAMPOS values(8,'etp2califmedica','Entrevista medica', 2);
Insert into TBL_MAET_CAMPOS values(9,'etp2comentarios','Comentarios adicionales', 2);

Insert into TBL_MAET_CAMPOS values(10,'etp3puntajeprom','Puntaje promedio del proceso', 3);
Insert into TBL_MAET_CAMPOS values(11,'etp3salarioacordado','Salario acordado', 3);
Insert into TBL_MAET_CAMPOS values(12,'etp3diaingreso','Dia de ingreso acordado', 3);

insert into TBL_MAET_ROLES values(13, 'Desarrollador','Rol desarrollador');
insert into TBL_MAET_ROLES values(14, 'Devops','Desarrollador de operaciondes de TI');
insert into TBL_MAET_ROLES values(15, 'Automatizador','Automatizador de pruebas');

insert into TBL_FLUJO_ETAPAS values(1,1,2);
insert into TBL_FLUJO_ETAPAS values(2,2,3);
